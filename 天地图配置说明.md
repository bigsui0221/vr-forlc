# 🗺️ 天地图API密钥配置说明

## 📋 概述

您的项目已成功修改为使用天地图卫星地图作为底图。为了正常显示地图，您需要申请天地图API密钥。

## 🚀 快速开始

### 第一步：申请天地图API密钥

1. **访问天地图官网**
   - 网址：https://www.tianditu.gov.cn/

2. **注册账号**
   - 点击右上角"注册"
   - 填写手机号、邮箱等信息完成注册
   - 验证邮箱和手机号

3. **登录控制台**
   - 登录后点击"控制台"
   - 进入开发者控制台

4. **创建应用**
   - 点击"应用管理" → "我的应用"
   - 点击"创建新应用"
   - 填写应用信息：
     ```
     应用名称：利川水库VR监测系统
     应用类型：浏览器端
     应用描述：水库监测可视化平台
     ```

5. **获取API密钥**
   - 创建成功后，复制生成的API密钥（tk参数）

### 第二步：配置API密钥

1. **打开配置文件**
   ```
   src/config/mapConfig.js
   ```

2. **替换API密钥**
   ```javascript
   export const mapConfig = {
     // 将"您的天地图API密钥"替换为实际密钥
     tiandituKey: "您申请到的实际API密钥",
     // ...其他配置
   };
   ```

3. **保存文件并重新构建项目**
   ```bash
   pnpm run build
   ```

### 第三步：重启Nginx查看效果

```powershell
# 重启Nginx
cd "D:\水库二期\forShow\nginx\nginx-1.24.0"
.\nginx.exe -s quit
.\nginx.exe

# 访问项目查看地图
Start-Process "http://192.168.150.253:1999"
```

## 🔧 配置详情

### 地图服务类型

项目配置了以下天地图服务：

1. **卫星影像** (`satellite`)
   - 高清卫星图像
   - 适合查看地形地貌

2. **卫星注记** (`satelliteAnnotation`)
   - 地名、道路标注
   - 叠加在卫星图像上

3. **矢量地图** (`vector`) - 备选
   - 传统矢量地图
   - 可在配置中切换

### 自定义配置

您可以在 `mapConfig.js` 中调整以下设置：

```javascript
// 调整注记层透明度
satelliteAnnotation: {
  opacity: 0.8 // 0.0-1.0，越小越透明
}

// 调整地图初始视图
defaultView: {
  center: [108.9375, 30.2958], // 中心坐标
  zoom: 10,                    // 初始缩放级别
  minZoom: 5,                  // 最小缩放
  maxZoom: 18                  // 最大缩放
}
```

## 🛠️ 故障排除

### 常见问题

#### 1. 地图显示空白或错误
**可能原因：**
- API密钥未配置或无效
- 网络连接问题
- 服务器限制

**解决方案：**
```javascript
// 检查浏览器控制台，查看错误信息
// 确认API密钥正确配置
// 检查网络连接
```

#### 2. 地图显示高德地图而不是天地图
**原因：** API密钥未配置，系统自动使用备用地图

**解决方案：**
1. 检查 `mapConfig.js` 中的密钥是否正确
2. 确认密钥不是默认的"您的天地图API密钥"

#### 3. 控制台显示密钥警告
```
天地图API密钥未配置，请在mapConfig.js中设置您的密钥
```

**解决方案：**
按照第二步重新配置API密钥

### 调试方法

#### 1. 检查配置
```javascript
// 在浏览器控制台执行
console.log("当前地图配置：", mapConfig);
console.log("API密钥有效性：", validateApiKey());
```

#### 2. 查看网络请求
- 打开浏览器开发者工具
- 切换到 Network 标签
- 刷新页面，查看地图瓦片请求是否成功

#### 3. 手动测试API
在浏览器中访问以下URL（替换为您的密钥）：
```
https://t0.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=img&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX=1&TILEROW=0&TILECOL=0&tk=您的API密钥
```

## 📊 备用方案

如果天地图服务不可用，系统会自动降级：

1. **第一备用**：高德地图卫星图（无需密钥）
2. **第二备用**：OpenStreetMap（无需密钥）

## 🎯 优化建议

### 1. 设置备用密钥
```javascript
backupKeys: [
  "备用密钥1",
  "备用密钥2"
]
```

### 2. 性能优化
- 适当调整注记层透明度
- 根据需要切换地图类型
- 设置合适的缩放范围

### 3. 监控使用量
- 定期查看天地图控制台的API使用统计
- 避免超出配额限制

## 📞 技术支持

如果遇到问题：

1. **查看天地图官方文档**
   - 文档地址：https://lbs.tianditu.gov.cn/docs/#/

2. **检查API配额**
   - 登录天地图控制台查看使用情况

3. **联系天地图客服**
   - 官方技术支持

## 🎉 配置完成

配置完成后，您将看到：
- ✅ 高清卫星地图底图
- ✅ 清晰的地名标注
- ✅ 流畅的地图交互
- ✅ 专业的水库监测展示效果

---

**注意：** 天地图API有使用配额限制，请根据实际需求选择合适的服务套餐。 